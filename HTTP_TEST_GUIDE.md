# âœ… HTTP GET é…ç½®å®Œæˆ

## ğŸ‰ å·²å®Œæˆé…ç½®

### ä¼ºæœå™¨è¨­å®š
- **Base URL**: `http://update.feiloli.com.tw:5539`
- **API ç«¯é»**: `/textselectdata/{mac}`
- **å®Œæ•´ URL ç¯„ä¾‹**: `http://update.feiloli.com.tw:5539/textselectdata/083A8DE1ED14`
- **é è¨­ MAC åœ°å€**: `083A8DE1ED14`

### åŠŸèƒ½è®Šæ›´
âœ… MQTT æ”¹ç‚º HTTP GET è¼ªè©¢
âœ… MAC åœ°å€ä½œç‚º URL è·¯å¾‘åƒæ•¸
âœ… æ”¯æ´å‹•æ…‹ MAC åœ°å€è¼¸å…¥
âœ… è‡ªå‹•é¡¯ç¤ºè«‹æ±‚/éŒ¯èª¤è¨ˆæ•¸
âœ… å‘½ä»¤è¨˜éŒ„æ•´åˆ
âœ… ç§»é™¤ MQTT é€£ç·šè¦æ±‚ï¼ˆæŒ‰éˆ•ç›´æ¥å¯ç”¨ï¼‰

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. é–‹å•Ÿé é¢
1. ç”¨ç€è¦½å™¨é–‹å•Ÿ `index.html`
2. é–‹å•Ÿç€è¦½å™¨æ§åˆ¶å° (F12) æŸ¥çœ‹æ—¥èªŒ

### 2. æ¸¬è©¦å–®æ¬¡è«‹æ±‚
1. åœ¨ã€Œè®€å–æ©Ÿå°è³‡æ–™ã€å€å¡Š
2. è¼¸å…¥ MAC åœ°å€ï¼š`083A8DE1ED14` (å·²é å¡«)
3. é»æ“Šã€ŒğŸ“¤ ç™¼é€è®€å–å‘½ä»¤ã€
4. æŸ¥çœ‹å½ˆå‡ºè¦–çª—çš„è³‡æ–™é è¦½
5. åœ¨æ§åˆ¶å°æŸ¥çœ‹å®Œæ•´å›æ‡‰

### 3. æ¸¬è©¦è¼ªè©¢åŠŸèƒ½ï¼ˆé¸ç”¨ï¼‰
1. é»æ“Šã€Œé–‹å§‹è¼ªè©¢ã€æŒ‰éˆ•
2. ç³»çµ±æœƒæ¯ 5 ç§’è‡ªå‹•ç™¼é€è«‹æ±‚
3. æŸ¥çœ‹ã€Œè«‹æ±‚æ¬¡æ•¸ã€è¨ˆæ•¸å™¨å¢åŠ 
4. é»æ“Šã€Œåœæ­¢è¼ªè©¢ã€åœæ­¢

### 4. æ¸¬è©¦ä¸åŒ MAC åœ°å€
1. ä¿®æ”¹ MAC è¼¸å…¥æ¡†çš„å€¼
2. é»æ“Šã€Œç™¼é€è®€å–å‘½ä»¤ã€
3. URL æœƒè‡ªå‹•æ›´æ–°ç‚ºæ–°çš„ MAC

---

## ğŸ”§ æ§åˆ¶å°æ¸¬è©¦å‘½ä»¤

åœ¨ç€è¦½å™¨æ§åˆ¶å° (F12) å¯åŸ·è¡Œï¼š

```javascript
// 1. æŸ¥çœ‹ç•¶å‰é…ç½®
console.log(httpConfig);

// 2. æ¸¬è©¦å»ºæ§‹ URL
buildHttpUrl('083A8DE1ED14');
// è¼¸å‡º: "http://update.feiloli.com.tw:5539/textselectdata/083A8DE1ED14"

// 3. æ¸¬è©¦å–®æ¬¡è«‹æ±‚
await sendHttpRequest('083A8DE1ED14');

// 4. æ¸¬è©¦é€£ç·š
await testHttpConnection();

// 5. é–‹å§‹è¼ªè©¢
startHttpPolling();

// 6. åœæ­¢è¼ªè©¢
stopHttpPolling();

// 7. ä¿®æ”¹è¼ªè©¢é–“éš” (æ¯«ç§’)
httpPollingInterval = 10000; // æ”¹ç‚º 10 ç§’

// 8. æŸ¥çœ‹çµ±è¨ˆè³‡æ–™
console.log('è«‹æ±‚æ¬¡æ•¸:', httpRequestCount);
console.log('éŒ¯èª¤æ¬¡æ•¸:', httpErrorCount);
console.log('æœ€å¾Œå›æ‡‰:', httpLastResponse);
```

---

## ğŸ“Š é æœŸè¡Œç‚º

### æˆåŠŸæ™‚
- âœ… ç‹€æ…‹æŒ‡ç¤ºç‡ˆè®Šç¶ è‰²ä¸¦é–ƒçˆ
- âœ… é¡¯ç¤ºã€ŒHTTP é€£ç·šä¸­ - è«‹æ±‚æˆåŠŸã€
- âœ… æ§åˆ¶å°é¡¯ç¤ºå®Œæ•´å›æ‡‰è³‡æ–™
- âœ… å½ˆå‡ºè¦–çª—é¡¯ç¤ºè³‡æ–™é è¦½
- âœ… å‘½ä»¤è¨˜éŒ„æ–°å¢æˆåŠŸé …ç›®
- âœ… è«‹æ±‚æ¬¡æ•¸ +1

### å¤±æ•—æ™‚
- âŒ ç‹€æ…‹æŒ‡ç¤ºç‡ˆè®Šç´…è‰²
- âŒ é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼ˆè¶…æ™‚/ç¶²è·¯éŒ¯èª¤ç­‰ï¼‰
- âŒ æ§åˆ¶å°é¡¯ç¤ºéŒ¯èª¤è©³æƒ…
- âŒ éŒ¯èª¤æ¬¡æ•¸ +1

---

## ğŸ” å¸¸è¦‹å•é¡Œæ’æŸ¥

### Q1: è«‹æ±‚ä¸€ç›´è¶…æ™‚
**å¯èƒ½åŸå› ï¼š**
- ä¼ºæœå™¨æœªå•Ÿå‹•æˆ–ç„¡æ³•è¨ªå•
- é˜²ç«ç‰†é˜»æ“‹åŸ è™Ÿ 5539
- MAC åœ°å€ä¸å­˜åœ¨

**è§£æ±ºæ–¹æ³•ï¼š**
```javascript
// å¢åŠ è¶…æ™‚æ™‚é–“
httpConfig.timeout = 30000; // 30 ç§’

// æ¸¬è©¦ä¼ºæœå™¨é€£é€šæ€§
fetch('http://update.feiloli.com.tw:5539')
  .then(r => console.log('ä¼ºæœå™¨ç‹€æ…‹:', r.status))
  .catch(e => console.error('ç„¡æ³•é€£ç·š:', e));
```

### Q2: CORS éŒ¯èª¤
**éŒ¯èª¤è¨Šæ¯ï¼š** `Access to fetch at ... has been blocked by CORS policy`

**è§£æ±ºæ–¹æ³•ï¼š**
ä¼ºæœå™¨éœ€è¦è¨­å®š CORS æ¨™é ­ï¼š
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET
```

### Q3: å›æ‡‰æ ¼å¼éŒ¯èª¤
**å¯èƒ½åŸå› ï¼š** å›æ‡‰ä¸æ˜¯ JSON æ ¼å¼

**è§£æ±ºæ–¹æ³•ï¼š**
ä¿®æ”¹ `sendHttpRequest()` ä¸­çš„è§£ææ–¹å¼ï¼š
```javascript
// å¦‚æœæ˜¯ç´”æ–‡å­—
const data = await response.text();

// å¦‚æœæ˜¯å…¶ä»–æ ¼å¼
const data = await response.blob();
```

---

## ğŸ“ é€²éšé…ç½®

### ä¿®æ”¹è¼ªè©¢é–“éš”
```javascript
// åœ¨ index.html ä¸­æ‰¾åˆ°
httpPollingInterval = 5000; // é è¨­ 5 ç§’

// ä¿®æ”¹ç‚ºå…¶ä»–å€¼ï¼ˆæ¯«ç§’ï¼‰
httpPollingInterval = 3000;  // 3 ç§’
httpPollingInterval = 10000; // 10 ç§’
httpPollingInterval = 60000; // 1 åˆ†é˜
```

### ä¿®æ”¹è¶…æ™‚æ™‚é–“
```javascript
// åœ¨ httpConfig ä¸­
timeout: 10000 // é è¨­ 10 ç§’

// ä¿®æ”¹ç‚º
timeout: 20000 // 20 ç§’
```

### æ–°å¢æŸ¥è©¢åƒæ•¸ï¼ˆå¦‚æœéœ€è¦ï¼‰
```javascript
httpConfig.params = {
    key1: 'value1',
    key2: 'value2'
};
// URL æœƒè®Šæˆ: ...textselectdata/MAC?key1=value1&key2=value2
```

### æ–°å¢ HTTP æ¨™é ­ï¼ˆå¦‚éœ€èº«ä»½é©—è­‰ï¼‰
```javascript
httpConfig.headers = {
    'Authorization': 'Bearer YOUR_TOKEN',
    'X-API-Key': 'YOUR_KEY'
};
```

---

## âœ¨ åŠŸèƒ½ç‰¹é»

1. **å‹•æ…‹ MAC åœ°å€** - æ”¯æ´åœ¨ URL è·¯å¾‘ä¸­æ’å…¥ MAC
2. **è‡ªå‹•é‡è©¦** - è¼ªè©¢æ¨¡å¼ä¸‹å¤±æ•—è‡ªå‹•é‡è©¦
3. **éŒ¯èª¤è¿½è¹¤** - è¨ˆæ•¸ä¸¦é¡¯ç¤ºè«‹æ±‚/éŒ¯èª¤æ¬¡æ•¸
4. **è¦–è¦ºå›é¥‹** - ç‹€æ…‹ç‡ˆã€è¼‰å…¥å‹•ç•«ã€å½ˆå‡ºè¦–çª—
5. **å‘½ä»¤è¨˜éŒ„** - æ‰€æœ‰è«‹æ±‚å’Œå›æ‡‰éƒ½è¨˜éŒ„åœ¨ UI
6. **æ§åˆ¶å°æ—¥èªŒ** - è©³ç´°çš„é™¤éŒ¯è³‡è¨Š

---

## ğŸš€ å¾ŒçºŒæ“´å……

å¦‚éœ€é€²ä¸€æ­¥å®¢è£½åŒ–ï¼Œå¯ä¿®æ”¹ `handleHttpResponse(data)` å‡½æ•¸ï¼š

```javascript
function handleHttpResponse(data) {
    // ç¯„ä¾‹ï¼šè§£æç‰¹å®šæ¬„ä½
    if (data.status === 'ok') {
        console.log('è³‡æ–™:', data.payload);
        
        // å„²å­˜åˆ° Firebase
        db.collection('machineData').add({
            mac: httpConfig.currentMac,
            data: data,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
    }
    
    // ç¯„ä¾‹ï¼šæ›´æ–°ç‰¹å®š UI å…ƒç´ 
    document.getElementById('custom-display').textContent = data.someField;
}
```

---

æº–å‚™å¥½äº†ï¼å¯ä»¥é–‹å§‹æ¸¬è©¦äº† ğŸ‰
