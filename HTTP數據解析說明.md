# ğŸ“Š HTTP æ•¸æ“šè§£æåŠŸèƒ½èªªæ˜

## âœ¨ æ–°å¢åŠŸèƒ½

å·²æ·»åŠ äº†**è‡ªå‹•åŒ–çš„ HTTP å›æ‡‰æ•¸æ“šè§£æåŠŸèƒ½**ï¼Œå¯ä»¥è‡ªå‹•è­˜åˆ¥ä¸¦æå–ä»¥ä¸‹ä¿¡æ¯ï¼š

- ğŸ“ˆ **ç´¯ç©æŠ•å¹£æ•¸** (plays / coins)
- ğŸ“Š **ç´¯ç©å‡ºè²¨æ¬¡æ•¸** (payouts / dispenses)

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. **å¤šæ ¼å¼è‡ªå‹•è­˜åˆ¥**

æ”¯æŒå¤šç¨®å¸¸è¦‹çš„æ•¸æ“šæ ¼å¼ï¼š

#### âœ… JSON æ ¼å¼
```json
{
  "plays": 12345,
  "payouts": 6789
}
```

æˆ–åµŒå¥—æ ¼å¼ï¼š
```json
{
  "machine": {
    "plays": 12345,
    "payouts": 6789
  }
}
```

#### âœ… æ–‡æœ¬æ ¼å¼

- **å†’è™Ÿåˆ†éš”**ï¼š`plays:12345,payouts:6789`
- **é€—è™Ÿåˆ†éš”**ï¼š`12345,6789`
- **ç©ºç™½åˆ†éš”**ï¼š`12345 6789`
- **æ›è¡Œåˆ†éš”**ï¼š`12345\n6789`

#### âœ… è‡ªå®šç¾©æ¬„ä½å

ç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥ä»¥ä¸‹æ¬„ä½åï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰ï¼š

**æŠ•å¹£ç›¸é—œ**ï¼š
- plays, play, coins, coin, investment
- æŠ•å¹£, æŠ•å¸, cumulative_plays, total_plays

**å‡ºè²¨ç›¸é—œ**ï¼š
- payouts, payout, dispense, dispenses
- å‡ºè²¨, å‡ºè´§, distribution, cumulative_payouts, total_payouts

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
ä¼ºæœå™¨è¿”å›æ•¸æ“š
    â†“
è‡ªå‹•è§£æï¼ˆparseHttpDataï¼‰
    â†“
è­˜åˆ¥æ ¼å¼ï¼ˆJSON / æ–‡æœ¬ï¼‰
    â†“
æå–æŠ•å¹£æ•¸å’Œå‡ºè²¨æ¬¡æ•¸
    â†“
åœ¨ UI ä¸­é¡¯ç¤ºçµæœ
    â†“
ä¿å­˜åˆ° window.lastParsedMachineData
```

---

## ğŸ“ UI é¡¯ç¤º

ç•¶æˆåŠŸè§£ææ•¸æ“šå¾Œï¼Œæœƒåœ¨ã€Œå‘½ä»¤è¨˜éŒ„ã€ä¸‹æ–¹é¡¯ç¤ºï¼š

```
ğŸ“Š æ©Ÿå°æ•¸æ“šè§£æçµæœ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¯ç©æŠ•å¹£æ•¸              â”‚
â”‚     12,345              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¯ç©å‡ºè²¨æ¬¡æ•¸            â”‚
â”‚      6,789              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¼å¼: json | æ™‚é–“: 14:30:45
```

---

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šè‡ªå‹•è§£æï¼ˆæ¨è–¦ï¼‰

ç•¶æ‚¨é»æ“Šã€ŒğŸ“¤ æ¸¬è©¦æŸ¥è©¢ã€æˆ–é€²è¡Œè¼ªè©¢æ™‚ï¼š
1. âœ… ç³»çµ±è‡ªå‹•ç™¼é€ HTTP è«‹æ±‚
2. âœ… è‡ªå‹•è§£æå›æ‡‰æ•¸æ“š
3. âœ… è‡ªå‹•åœ¨ UI ä¸­é¡¯ç¤ºçµæœ

ç„¡éœ€ä»»ä½•é¡å¤–æ“ä½œï¼

### æ–¹æ³• 2ï¼šæ‰‹å‹•æ¸¬è©¦è§£æ

åœ¨ç€è¦½å™¨æ§åˆ¶å°åŸ·è¡Œï¼š

```javascript
// æ¸¬è©¦ JSON æ ¼å¼
const testJson = { plays: 12345, payouts: 6789 };
const result = parseHttpData(testJson);
console.log(result);

// æ¸¬è©¦æ–‡æœ¬æ ¼å¼
const testText = "plays:12345,payouts:6789";
const result2 = parseHttpData(testText);
console.log(result2);

// æŸ¥çœ‹æœ€å¾Œè§£æçš„æ•¸æ“š
console.log(window.lastParsedMachineData);
```

### æ–¹æ³• 3ï¼šç²å–è§£æçµæœ

```javascript
// ç²å–æœ€å¾Œä¸€æ¬¡è§£æçš„æ©Ÿå°æ•¸æ“š
const machineData = window.lastParsedMachineData;

if (machineData) {
    console.log('æŠ•å¹£æ•¸:', machineData.plays);
    console.log('å‡ºè²¨æ¬¡æ•¸:', machineData.payouts);
}
```

---

## ğŸ“‹ æ”¯æŒçš„æ•¸æ“šæ ¼å¼è©³è§£

### æ ¼å¼ 1ï¼šæ¨™æº– JSON
```json
{
  "plays": 12345,
  "payouts": 6789
}
```
**å„ªå…ˆç´š**ï¼šæœ€é«˜ âœ…

### æ ¼å¼ 2ï¼šåµŒå¥— JSON
```json
{
  "data": {
    "machine": {
      "plays": 12345,
      "payouts": 6789
    }
  }
}
```
**å„ªå…ˆç´š**ï¼šé«˜ âœ…

### æ ¼å¼ 3ï¼šè‡ªå®šç¾©æ¬„ä½å
```json
{
  "cumulative_plays": 12345,
  "total_payouts": 6789
}
```
**å„ªå…ˆç´š**ï¼šä¸­ âœ…

### æ ¼å¼ 4ï¼šä¸­æ–‡æ¬„ä½
```json
{
  "æŠ•å¹£": 12345,
  "å‡ºè²¨": 6789
}
```
**å„ªå…ˆç´š**ï¼šä¸­ âœ…

### æ ¼å¼ 5ï¼šæ–‡æœ¬æ ¼å¼ï¼ˆå†’è™Ÿåˆ†éš”ï¼‰
```
plays:12345,payouts:6789
```
**å„ªå…ˆç´š**ï¼šä½ âš ï¸

### æ ¼å¼ 6ï¼šç°¡å–®æ•¸å­—ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
```
12345,6789
```
**å„ªå…ˆç´š**ï¼šå¾ˆä½ âš ï¸

### æ ¼å¼ 7ï¼šä½ç½®æ¨æ¸¬
```
12345 6789
```
**å„ªå…ˆç´š**ï¼šæœ€ä½ï¼ˆæœ€å¾Œæ‰æœƒå˜—è©¦ï¼‰

---

## ğŸ” èª¿è©¦å’Œç›£æ§

### æŸ¥çœ‹å®Œæ•´çš„è§£æéç¨‹

åœ¨æ§åˆ¶å°ä¸­ï¼Œæ‚¨æœƒçœ‹åˆ°è©³ç´°çš„æ—¥èªŒè¼¸å‡ºï¼š

```javascript
// æ¯ä¸€æ­¥éƒ½æœ‰æ¸…æ™°çš„æç¤º
ğŸ“„ æ¥æ”¶åˆ°æ–‡æœ¬æ•¸æ“šï¼Œå˜—è©¦æå–çµæ§‹åŒ–ä¿¡æ¯...
ğŸ” åˆ†ææ–‡æœ¬æ•¸æ“šçµæ§‹...
âœ… æ ¼å¼è­˜åˆ¥: å†’è™Ÿåˆ†éš”ç¬¦
âœ… æ‰¾åˆ°æŠ•å¹£æ¬„ä½: "plays" = 12345
âœ… æ‰¾åˆ°å‡ºè²¨æ¬„ä½: "payouts" = 6789
ğŸ–¼ï¸ æ›´æ–° UI é¡¯ç¤º: {...}
âœ… UI å·²æ›´æ–°
```

### ç›£æ§è§£æå¤±æ•—

å¦‚æœæ•¸æ“šç„¡æ³•è§£æï¼š

```
âš ï¸ ç„¡æ³•è§£ææ•¸æ“š
âŒ æ•¸æ“šè§£æå¤±æ•—: Error: ...
```

æ­¤æ™‚æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„ `httpLastResponse` æŸ¥çœ‹åŸå§‹æ•¸æ“šï¼š
```javascript
console.log(httpLastResponse);
```

---

## ğŸ’¡ è‡ªå®šç¾©è§£æ

å¦‚æœæ‚¨çš„æ•¸æ“šæ ¼å¼ä¸åœ¨æ”¯æŒçš„åˆ—è¡¨ä¸­ï¼Œå¯ä»¥è‡ªå®šç¾©è§£æå‡½æ•¸ï¼š

### ç¤ºä¾‹ï¼šè‡ªå®šç¾©æ ¼å¼

å‡è¨­æ‚¨çš„ä¼ºæœå™¨è¿”å›æ ¼å¼ç‚ºï¼š
```
{
  "coin_count": 12345,
  "dispensing_count": 6789
}
```

æ‚¨å¯ä»¥ä¿®æ”¹è§£æå‡½æ•¸ä¸­çš„æ¬„ä½åç¨±åˆ—è¡¨ï¼š

åœ¨ä»£ç¢¼ä¸­æŸ¥æ‰¾ `const playsKeywords = [...]` ä¸¦æ·»åŠ ï¼š
```javascript
const playsKeywords = ['plays', 'play', 'coins', 'coin', 'coin_count', ...];
const payoutsKeywords = ['payouts', 'payout', 'dispense', 'dispensing_count', ...];
```

---

## ğŸ“Š å¯¦æ™‚æ•¸æ“šç›£æ§

### ç›£æ§æ¨¡å¼ 1ï¼šå¯¦æ™‚é¡¯ç¤ºæ›´æ–°

å•Ÿç”¨è‡ªå‹•è¼ªè©¢ï¼Œæ¯æ¬¡è¼ªè©¢éƒ½æœƒè‡ªå‹•è§£æå’Œé¡¯ç¤ºæ–°çš„æ•¸æ“šã€‚

```javascript
// å•Ÿç”¨ 2 ç§’è¼ªè©¢
document.getElementById('poll-interval').value = 2000;
document.getElementById('auto-poll-enabled').checked = true;
startAutoPolling();
```

æ­¤æ™‚æ‚¨æœƒçœ‹åˆ°æ•¸æ“šå¯¦æ™‚æ›´æ–°ã€‚

### ç›£æ§æ¨¡å¼ 2ï¼šæ•¸æ“šè¶¨å‹¢åˆ†æ

```javascript
// ä¿å­˜æ¯æ¬¡çš„è§£æçµæœ
let dataHistory = [];

// ä¿®æ”¹ updateMachineDataDisplay å‡½æ•¸ä¾†ä¿å­˜æ­·å²
// æˆ–æ‰‹å‹•è¨˜éŒ„
const currentData = window.lastParsedMachineData;
dataHistory.push({
    timestamp: new Date(),
    ...currentData
});

// åˆ†ææ•¸æ“šè®ŠåŒ–
console.table(dataHistory);
```

---

## âš™ï¸ é€²éšé…ç½®

### é…ç½® 1ï¼šç¦ç”¨è‡ªå‹•é¡¯ç¤º

å¦‚æœæ‚¨åªæƒ³è§£æä½†ä¸æƒ³è‡ªå‹•é¡¯ç¤ºåœ¨ UI ä¸­ï¼Œå¯ä»¥ä¿®æ”¹ `handleHttpResponse` å‡½æ•¸ï¼š

```javascript
// åœ¨ handleHttpResponse ä¸­è¨»è§£æ‰
// updateMachineDataDisplay(parsedData);
```

### é…ç½® 2ï¼šæ·»åŠ æ•¸æ“šé©—è­‰

```javascript
// åœ¨ handleHttpResponse ä¸­æ·»åŠ é©—è­‰
if (parsedData.plays !== null && parsedData.plays > 0) {
    // åªæœ‰åœ¨æ•¸æ“šæœ‰æ•ˆæ™‚æ‰é¡¯ç¤º
    updateMachineDataDisplay(parsedData);
}
```

### é…ç½® 3ï¼šé›†æˆåˆ° Firebase

```javascript
// ä¿å­˜è§£æçš„æ•¸æ“šåˆ° Firebase
async function saveMachineDataToFirebase(machineData) {
    try {
        await db.collection('machines').doc('machine-1').update({
            plays: machineData.plays,
            payouts: machineData.payouts,
            lastUpdate: new Date()
        });
        console.log('âœ… æ•¸æ“šå·²ä¿å­˜åˆ° Firebase');
    } catch (error) {
        console.error('âŒ ä¿å­˜å¤±æ•—:', error);
    }
}

// åœ¨ handleHttpResponse ä¸­èª¿ç”¨
// await saveMachineDataToFirebase(parsedData);
```

---

## ğŸ§ª æ¸¬è©¦æ•¸æ“š

### æ¸¬è©¦ 1ï¼šæ¨™æº– JSON

```javascript
// åœ¨æ§åˆ¶å°åŸ·è¡Œ
handleHttpResponse({
    plays: 12345,
    payouts: 6789
});
```

### æ¸¬è©¦ 2ï¼šæ–‡æœ¬æ ¼å¼

```javascript
handleHttpResponse("plays:12345,payouts:6789");
```

### æ¸¬è©¦ 3ï¼šåµŒå¥—çµæ§‹

```javascript
handleHttpResponse({
    machine: {
        plays: 12345,
        payouts: 6789
    }
});
```

### æ¸¬è©¦ 4ï¼šä¸­æ–‡æ¬„ä½

```javascript
handleHttpResponse({
    æŠ•å¹£: 12345,
    å‡ºè²¨: 6789
});
```

---

## ğŸ“ˆ åŠŸèƒ½å°æ¯”

| åŠŸèƒ½ | ä¹‹å‰ | ä¹‹å¾Œ |
|------|------|------|
| æ•¸æ“šæ¥æ”¶ | âœ… | âœ… |
| æ•¸æ“šé¡¯ç¤º | âŒ | âœ… |
| è‡ªå‹•è§£æ | âŒ | âœ… |
| æ ¼å¼è­˜åˆ¥ | âŒ | âœ… (7+ ç¨®) |
| UI é¡¯ç¤º | âŒ | âœ… |
| æ­·å²è¨˜éŒ„ | âŒ | âœ… (å¯æ“´å±•) |

---

## ğŸ” ä»£ç¢¼ä½ç½®åƒè€ƒ

| åŠŸèƒ½ | ä½ç½® |
|------|------|
| ä¸»è§£æå‡½æ•¸ | `parseHttpData()` |
| æ–‡æœ¬è§£æ | `parseTextData()` |
| JSON è§£æ | `extractMachineData()` |
| UI æ›´æ–° | `updateMachineDataDisplay()` |
| èª¿ç”¨ä½ç½® | `handleHttpResponse()` |

---

## âš ï¸ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼æ•¸æ“šæ²’æœ‰é¡¯ç¤ºï¼Ÿ

**A**: æª¢æŸ¥ä»¥ä¸‹å¹¾é»ï¼š
1. ä¼ºæœå™¨æ˜¯å¦è¿”å›äº†æ•¸æ“šï¼Ÿ
2. æ•¸æ“šæ ¼å¼æ˜¯å¦ç¬¦åˆæ”¯æŒçš„æ ¼å¼ï¼Ÿ
3. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤ä¿¡æ¯

ä½¿ç”¨ `console.log(httpLastResponse)` æŸ¥çœ‹åŸå§‹æ•¸æ“šã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ¬„ä½åç¨±è­˜åˆ¥ï¼Ÿ

**A**: åœ¨ `parseTextData()` æˆ– `extractMachineData()` ä¸­ï¼Œä¿®æ”¹é—œéµå­—åˆ—è¡¨ï¼š

```javascript
const playsKeywords = ['plays', 'play', 'coins', 'YOUR_FIELD_NAME', ...];
```

### Q: æ•¸æ“šè§£æéŒ¯èª¤æ€éº¼è¾¦ï¼Ÿ

**A**: 
1. åœ¨æ§åˆ¶å°æª¢æŸ¥å…·é«”çš„éŒ¯èª¤ä¿¡æ¯
2. ä½¿ç”¨ `console.log(httpLastResponse)` æŸ¥çœ‹åŸå§‹æ•¸æ“š
3. æ ¹æ“šå¯¦éš›æ ¼å¼è‡ªå®šç¾©è§£æé‚è¼¯

### Q: èƒ½å¦åŒæ™‚æå–å…¶ä»–æ¬„ä½ï¼Ÿ

**A**: å¯ä»¥ï¼åœ¨ `extractMachineData()` ä¸­æ·»åŠ æ–°çš„æ¬„ä½æå–é‚è¼¯ï¼Œé¡ä¼¼æ–¼ plays å’Œ payouts çš„æ–¹å¼ã€‚

---

## ğŸ“ ä»£ç¢¼ä¿®æ”¹æ‘˜è¦

### æ–°å¢å‡½æ•¸ï¼š

1. **`parseHttpData(data)`** - ä¸»è§£æå‡½æ•¸ï¼Œè‡ªå‹•æª¢æ¸¬æ ¼å¼
2. **`parseTextData(textData)`** - æ–‡æœ¬æ ¼å¼è§£æ
3. **`extractMachineData(jsonData)`** - JSON æ ¼å¼è§£æ
4. **`updateMachineDataDisplay(machineData)`** - UI é¡¯ç¤ºæ›´æ–°

### ä¿®æ”¹å‡½æ•¸ï¼š

1. **`handleHttpResponse(data)`** - æ·»åŠ äº†è‡ªå‹•è§£æé‚è¼¯

### å…¨åŸŸè®Šæ•¸ï¼š

1. **`window.lastParsedMachineData`** - ä¿å­˜æœ€å¾Œè§£æçš„æ•¸æ“š

---

## âœ… é©—è­‰ä¿®å¾©

æ‰€æœ‰ä»£ç¢¼å·²é©—è­‰ï¼š
- âœ… ç„¡èªæ³•éŒ¯èª¤
- âœ… æ”¯æŒå¤šç¨®æ•¸æ“šæ ¼å¼
- âœ… è‡ªå‹•è­˜åˆ¥å’Œæå–
- âœ… å¯¦æ™‚ UI æ›´æ–°
- âœ… è©³ç´°çš„æ—¥èªŒè¼¸å‡º

---

**ä¿®æ”¹æ—¥æœŸ**ï¼š2025-10-23  
**åŠŸèƒ½ç‹€æ…‹**ï¼šâœ… å®Œå…¨å¯¦ç¾  
**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ“šå¯¦éš›ä¼ºæœå™¨æ•¸æ“šæ ¼å¼ï¼Œå¯é€²ä¸€æ­¥è‡ªå®šç¾©è§£æé‚è¼¯
