# ğŸ”§ HTTP è¼ªè©¢è‡ªå‹•è¨˜å¸³ - æŠ€è¡“å¯¦ç¾æ¸…å–®

**å¯¦ç¾æ—¥æœŸ**: 2025å¹´10æœˆ23æ—¥  
**åŠŸèƒ½ç‰ˆæœ¬**: v2.0 (Enhanced Change Detection & Batch Auto-Accounting)

---

## âœ… å·²å¯¦ç¾åŠŸèƒ½æ¸…å–®

### 1ï¸âƒ£ æ”¹é€²çš„ `updateDailyRecord()` å‡½æ•¸

**ä½ç½®**: `index.html` ç´„ 1876-1971 è¡Œ

**æ–°å¢æ¬„ä½**:
- âœ… `lastPlays` - ä¸Šä¸€æ¬¡çš„æŠ•å¹£æ•¸
- âœ… `lastPayouts` - ä¸Šä¸€æ¬¡çš„å‡ºè²¨æ•¸é‡
- âœ… `playsChanged` - æŠ•å¹£æ¬¡æ•¸æ˜¯å¦è®ŠåŒ–
- âœ… `payoutsChanged` - å‡ºè²¨æ•¸é‡æ˜¯å¦è®ŠåŒ–
- âœ… `history[].playsChanged` - æ­·å²è¨˜éŒ„ä¸­æŠ•å¹£æ¬¡æ•¸è®ŠåŒ–æ¨™è¨˜
- âœ… `history[].payoutsChanged` - æ­·å²è¨˜éŒ„ä¸­å‡ºè²¨æ•¸é‡è®ŠåŒ–æ¨™è¨˜
- âœ… `history[].playsDelta` - æŠ•å¹£æ¬¡æ•¸è®ŠåŒ–å€¼
- âœ… `history[].payoutsDelta` - å‡ºè²¨æ•¸é‡è®ŠåŒ–å€¼

**æª¢æ¸¬é‚è¼¯**:
```javascript
const playsChanged = (todayRecord.plays !== plays);
const payoutsChanged = (todayRecord.payouts !== payouts);
const isChanged = playsChanged || payoutsChanged;

if (isChanged) {
    const playsDelta = plays - todayRecord.plays;
    const payoutsDelta = payouts - todayRecord.payouts;
    // è¨˜éŒ„è®Šæ›´ä¿¡æ¯
}
```

**è¿”å›å€¼å¢å¼·**:
```javascript
return { 
    status: 'updated', 
    record: todayRecord, 
    playsChanged,      // âœ… æ–°å¢
    payoutsChanged,    // âœ… æ–°å¢
    playsDelta,        // âœ… æ–°å¢
    payoutsDelta       // âœ… æ–°å¢
};
```

**æ§åˆ¶å°è¼¸å‡º**:
```
ğŸ”„ æ•¸æ“šæœ‰è®ŠåŒ– - æ©Ÿå°: A001/ä¸Š1
   â­ æŠ•å¹£æ¬¡æ•¸è®ŠåŒ–: 280 â†’ 285 (å¢åŠ : +5)
   â­ å‡ºè²¨æ•¸é‡è®ŠåŒ–: 17 â†’ 18 (å¢åŠ : +1)
```

---

### 2ï¸âƒ£ æ”¹é€²çš„ `refreshAutoRecordTable()` å‡½æ•¸

**ä½ç½®**: `index.html` ç´„ 1933-2005 è¡Œ

**æ–°å¢åŠŸèƒ½**:
- âœ… è®Šæ›´ç‹€æ…‹æŒ‡ç¤ºç¬¦ï¼ˆğŸ”„, ğŸ’°, ğŸ“¦, âœ¨ï¼‰
- âœ… è®Šæ›´å€¼é¡¯ç¤ºï¼ˆ+Nï¼‰
- âœ… è©³ç´°çš„è®Šæ›´ä¿¡æ¯åœ¨æœ€å¾Œæ›´æ–°åˆ—ä¸­

**è¡¨æ ¼æ¬„ä½è®ŠåŒ–**:
```html
<!-- åŸæœ¬ï¼šç°¡å–®çš„æ›´æ–°è¨ˆæ•¸ -->
<td>${statusIcon} ${record.updateCount}</td>

<!-- ç¾åœ¨ï¼šè¤‡é›œçš„ç‹€æ…‹æŒ‡ç¤º -->
<td>${changeIndicator} ${record.updateCount}</td>
<!-- changeIndicator ç¤ºä¾‹: ğŸ”„ ğŸ’°ğŸ“¦ 3 -->
```

**è®Šæ›´æŒ‡ç¤ºç¬¦é‚è¼¯**:
```javascript
let changeIndicator = '';
if (record.updateCount > 1) {
    const playsStatus = record.playsChanged ? 'ğŸ’°' : '';
    const payoutsStatus = record.payoutsChanged ? 'ğŸ“¦' : '';
    changeIndicator = `ğŸ”„ ${playsStatus}${payoutsStatus}`;
} else {
    changeIndicator = 'âœ¨';
}
```

**è®Šæ›´å€¼é¡¯ç¤ºé‚è¼¯**:
```javascript
let changeInfo = '';
if (record.history && record.history.length > 1) {
    const lastHistory = record.history[record.history.length - 1];
    
    changeInfo = '<br/><small style="color: #9ca3af; font-size: 0.75rem;">';
    if (lastHistory.playsChanged && lastHistory.playsDelta !== undefined) {
        changeInfo += `ğŸ’° æŠ•å¹£: +${lastHistory.playsDelta} `;
    }
    if (lastHistory.payoutsChanged && lastHistory.payoutsDelta !== undefined) {
        changeInfo += `ğŸ“¦ å‡ºè²¨: +${lastHistory.payoutsDelta}`;
    }
    changeInfo += '</small>';
}
```

---

### 3ï¸âƒ£ å¢å¼·çš„ `pollAllMachines()` å‡½æ•¸

**ä½ç½®**: `index.html` ç´„ 8221-8280 è¡Œ

**æ–°å¢çµ±è¨ˆåŠŸèƒ½**:
- âœ… è¼ªè©¢é–‹å§‹æ™‚é–“è¨˜éŒ„
- âœ… è¼ªè©¢æ©Ÿå°è¨ˆæ•¸
- âœ… æ–°å¢è¨˜éŒ„è¨ˆæ•¸
- âœ… æ›´æ–°è¨˜éŒ„è¨ˆæ•¸
- âœ… è€—æ™‚è¨ˆç®—

**æ–°å¢å±€éƒ¨è®Šæ•¸**:
```javascript
const pollStartTime = new Date();
let pollCount = 0;      // è¼ªè©¢æ©Ÿå°æ•¸
let updateCount = 0;    // æœ‰è®ŠåŒ–çš„è¨˜éŒ„
let unchangedCount = 0; // æ–°å¢çš„è¨˜éŒ„
```

**çµ±è¨ˆé‚è¼¯**:
```javascript
// åœ¨è¼ªè©¢å¾Œçµ±è¨ˆçµæœ
if (window.dailyRecords) {
    Object.values(window.dailyRecords).forEach(record => {
        if (record.updateCount > 1) {
            updateCount++;  // æœ‰è®ŠåŒ–
        } else {
            unchangedCount++;  // æ–°è¨˜éŒ„
        }
    });
}

const pollDuration = ((pollEndTime - pollStartTime) / 1000).toFixed(1);
```

**æ”¹é€²çš„ç‹€æ…‹è¨Šæ¯**:
```javascript
showStatusMessage(`
    âœ… è¼ªè©¢å®Œæˆï¼
    - å·²æŸ¥è©¢: ${pollCount} å°æ©Ÿå°
    - æ–°å¢: ${unchangedCount} ç­†è¨˜éŒ„
    - æ›´æ–°: ${updateCount} ç­†è¨˜éŒ„
    - è€—æ™‚: ${pollDuration} ç§’
`, 'success');
```

---

### 4ï¸âƒ£ å¢å¼·çš„ `batchAddAllMachines()` å‡½æ•¸

**ä½ç½®**: `index.html` ç´„ 2055-2177 è¡Œ

**æ–°å¢åŠŸèƒ½**:
- âœ… æ–°å¢/æ›´æ–°/å¤±æ•—è¨ˆæ•¸
- âœ… æ“ä½œå‹æ…‹åˆ¤æ–·ï¼ˆæ–°å¢ vs æ›´æ–°ï¼‰
- âœ… è©³ç´°çš„æ“ä½œç¸½çµ
- âœ… æ‘˜è¦ä¿¡æ¯è¨˜éŒ„

**æ–°å¢å±€éƒ¨è®Šæ•¸**:
```javascript
let newCount = 0;         // æ–°å¢è¨˜éŒ„æ•¸
let updateCount = 0;      // æ›´æ–°è¨˜éŒ„æ•¸
let unchangedCount = 0;   // æœªè®ŠåŒ–è¨˜éŒ„æ•¸ï¼ˆæ–°å¢ï¼‰
let failedCount = 0;      // å¤±æ•—è¨ˆæ•¸

// çµ±è¨ˆä¿¡æ¯ç‰©ä»¶
const summaryInfo = {
    new: [],      // æ–°å¢çš„æ©Ÿå°
    updated: [],  // æ›´æ–°çš„æ©Ÿå°
    unchanged: [] // æœªè®ŠåŒ–çš„æ©Ÿå°
};
```

**æ“ä½œå‹æ…‹åˆ¤æ–·é‚è¼¯**:
```javascript
if (record.updateCount > 1) {
    // ğŸ”„ æ›´æ–°æ“ä½œ - æª¢æ¸¬åˆ°è®ŠåŒ–
    console.log(`ğŸ”„ æª¢æ¸¬åˆ°è®ŠåŒ– - æŠ•å¹£æ•¸è®ŠåŒ–: ${record.playsChanged}, å‡ºè²¨æ•¸é‡è®ŠåŒ–: ${record.payoutsChanged}`);
    updateCount++;
    summaryInfo.updated.push({
        id: machine.id,
        location: machine.location,
        plays: record.plays,
        payouts: record.payouts,
        playsChanged: record.playsChanged,
        payoutsChanged: record.payoutsChanged
    });
} else {
    // âœ¨ æ–°å¢æ“ä½œ - é¦–æ¬¡è¨˜éŒ„
    console.log(`âœ¨ æ–°å¢è¨˜éŒ„ - æ©Ÿå°: ${machine.id}/${machine.location}`);
    newCount++;
    summaryInfo.new.push({
        id: machine.id,
        location: machine.location,
        plays: record.plays,
        payouts: record.payouts
    });
}
```

**è©³ç´°çš„å®Œæˆç¸½çµ**:
```javascript
console.log(`ğŸ‰ æ‰¹é‡æ“ä½œå®Œæˆçµ±è¨ˆ:`);
console.log(`   âœ¨ æ–°å¢è¨˜éŒ„: ${newCount} ç­†`);
if (summaryInfo.new.length > 0) {
    console.log(`      ${summaryInfo.new.map(m => `${m.id}/${m.location}`).join(', ')}`);
}
console.log(`   ğŸ”„ æ›´æ–°è¨˜éŒ„: ${updateCount} ç­†`);
if (summaryInfo.updated.length > 0) {
    console.log(`      ${summaryInfo.updated.map(m => {
        const changes = [];
        if (m.playsChanged) changes.push(`ğŸ’°æŠ•å¹£`);
        if (m.payoutsChanged) changes.push(`ğŸ“¦å‡ºè²¨`);
        return `${m.id}/${m.location} (${changes.join('ã€')})`;
    }).join(', ')}`);
}
console.log(`   âŒ å¤±æ•—: ${failedCount} ç­†`);
```

---

## ğŸ“Š æ•¸æ“šçµæ§‹å°æ¯”

### èˆŠç‰ˆæœ¬è¨˜éŒ„çµæ§‹
```javascript
{
    machineId: "A001",
    location: "ä¸Š1",
    date: "2025-10-23",
    plays: 285,
    payouts: 18,
    createdAt: "2025/10/23 ä¸‹åˆ 08:57:07",
    updatedAt: "2025/10/23 ä¸‹åˆ 08:57:09",
    updateCount: 3,
    history: [
        { timestamp: "08:57:07", plays: 280, payouts: 17 },
        { timestamp: "08:57:08", plays: 282, payouts: 17 },
        { timestamp: "08:57:09", plays: 285, payouts: 18 }
    ]
}
```

### æ–°ç‰ˆæœ¬è¨˜éŒ„çµæ§‹ âœ…
```javascript
{
    machineId: "A001",
    location: "ä¸Š1",
    date: "2025-10-23",
    plays: 285,
    payouts: 18,
    createdAt: "2025/10/23 ä¸‹åˆ 08:57:07",
    updatedAt: "2025/10/23 ä¸‹åˆ 08:57:09",
    updateCount: 3,
    
    // âœ… æ–°å¢ï¼šä¸Šä¸€æ¬¡çš„å€¼ï¼ˆç”¨æ–¼æ¯”å°ï¼‰
    lastPlays: 280,
    lastPayouts: 17,
    
    // âœ… æ–°å¢ï¼šè®ŠåŒ–æ¨™è¨˜
    playsChanged: true,
    payoutsChanged: true,
    
    // âœ… æ–°å¢ï¼šè©³ç´°çš„è®ŠåŒ–æ­·å²
    history: [
        {
            timestamp: "08:57:07",
            plays: 280,
            payouts: 17,
            playsChanged: false,
            payoutsChanged: false,
            playsDelta: 0,
            payoutsDelta: 0
        },
        {
            timestamp: "08:57:08",
            plays: 282,
            payouts: 17,
            playsChanged: true,     // âœ… æŠ•å¹£æ•¸æœ‰è®ŠåŒ–
            payoutsChanged: false,
            playsDelta: 2,          // âœ… å¢åŠ äº†2æ¬¡æŠ•å¹£
            payoutsDelta: 0
        },
        {
            timestamp: "08:57:09",
            plays: 285,
            payouts: 18,
            playsChanged: true,     // âœ… æŠ•å¹£æ•¸æœ‰è®ŠåŒ–
            payoutsChanged: true,   // âœ… å‡ºè²¨æ•¸é‡æœ‰è®ŠåŒ–
            playsDelta: 3,          // âœ… å¢åŠ äº†3æ¬¡æŠ•å¹£
            payoutsDelta: 1         // âœ… å¢åŠ äº†1æ¬¡å‡ºè²¨
        }
    ]
}
```

---

## ğŸ”„ å‡½æ•¸èª¿ç”¨æµç¨‹åœ–

```
[ç”¨æˆ¶æ“ä½œ]
    â†“
[æŒ‰ä¸‹ã€Œç«‹å³è¼ªè©¢æ‰€æœ‰æ©Ÿå°ã€]
    â†“
pollAllMachines()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éæ­·æ‰€æœ‰æœ‰ MAC ä½å€çš„æ©Ÿå°          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. é¸å–æ©Ÿå° A001, A002...         â”‚
â”‚ 2. å°æ¯å°èª¿ç”¨ pollSingleMachine()   â”‚
â”‚ 3. é–“éš” 500ms é¿å…ä¼ºæœå™¨è² è·       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
pollSingleMachine(mac, devid)
    â†“
sendHttpRequest(mac)
    â†“
handleHttpResponse(data, mac, devid)
    â†“
parseHttpData(data, devid)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æå–æŠ•å¹£æ¬¡æ•¸ (plays) å’Œå‡ºè²¨æ•¸      â”‚
â”‚ é‡ (payouts)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
updateDailyRecord()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æª¢æ¸¬è®ŠåŒ–ï¼š                          â”‚
â”‚ - playsChanged?                     â”‚
â”‚ - payoutsChanged?                   â”‚
â”‚ - è¨ˆç®— playsDelta & payoutsDelta   â”‚
â”‚ - è¨˜éŒ„åˆ° history é™£åˆ—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
refreshAutoRecordTable()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨æ ¼é¡¯ç¤ºï¼š                          â”‚
â”‚ - ğŸ”„ ğŸ’°ğŸ“¦ 3  (æœ‰è®ŠåŒ–æŒ‡ç¤ºç¬¦)        â”‚
â”‚ - ğŸ’° æŠ•å¹£: +5 (å…·é«”è®ŠåŒ–å€¼)         â”‚
â”‚ - ğŸ“¦ å‡ºè²¨: +2                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[ç”¨æˆ¶æª¢æŸ¥è¡¨æ ¼]
    â†“
[æŒ‰ä¸‹ã€Œæ‰¹é‡æ–°å¢æ‰€æœ‰æ©Ÿå°ã€]
    â†“
batchAddAllMachines()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éæ­·æ‰€æœ‰è¼ªè©¢è¨˜éŒ„ï¼š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¦‚æœ updateCount > 1:              â”‚
â”‚   â†’ ğŸ”„ æ›´æ–°æ“ä½œ                    â”‚
â”‚   â†’ è¨˜éŒ„ updateCount++             â”‚
â”‚                                     â”‚
â”‚ å¦‚æœ updateCount = 1:              â”‚
â”‚   â†’ âœ¨ æ–°å¢æ“ä½œ                    â”‚
â”‚   â†’ è¨˜éŒ„ newCount++                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡«å…¥è¡¨å–®ä¸¦æäº¤ï¼š                    â”‚
â”‚ - æ©Ÿå°é¸æ“‡å™¨                        â”‚
â”‚ - æ—¥æœŸ                              â”‚
â”‚ - æŠ•å¹£æ•¸                            â”‚
â”‚ - å‡ºè²¨æ•¸                            â”‚
â”‚ - è§¸ç™¼è¡¨å–®æäº¤äº‹ä»¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[ç³»çµ±è‡ªå‹•ä¿å­˜åˆ° Firebase]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®Œæˆçµ±è¨ˆé¡¯ç¤ºï¼š                      â”‚
â”‚ âœ¨ æ–°å¢è¨˜éŒ„: X ç­†                  â”‚
â”‚ ğŸ”„ æ›´æ–°è¨˜éŒ„: Y ç­†                  â”‚
â”‚ âŒ å¤±æ•—: Z ç­†                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[æ¸…ç©ºè¼ªè©¢è¡¨æ ¼]
    â†“
[ç­‰å¾…ä¸‹æ¬¡è¼ªè©¢]
```

---

## ğŸ“ æ—¥èªŒè¿½è¹¤ç¯„ä¾‹

### å®Œæ•´çš„è¼ªè©¢å’Œæ‰¹é‡æ–°å¢æµç¨‹æ—¥èªŒ

```
=== é–‹å§‹ HTTP è¼ªè©¢æ‰€æœ‰æ©Ÿå° ===
=== è¼ªè©¢æ©Ÿå°æ¸…å–® ===
1. æ©Ÿå°ID: A001, MAC: 083A8DE1ED14, DevID: 1
2. æ©Ÿå°ID: A001, MAC: 083A8DE1ED14, DevID: 2
3. æ©Ÿå°ID: A002, MAC: 083A8DE1ED15, DevID: 1
========================

ğŸ“ æª¢æŸ¥ä¸¦æ›´æ–°æ¯æ—¥è¨˜éŒ„ - æ©Ÿå°: A001/ä¸Š1, plays: 285, payouts: 18
ğŸ“ å–®å° HTTP è¼ªè©¢ ===
æº–å‚™ç™¼é€ HTTP GET è«‹æ±‚åˆ°æ©Ÿå° - MAC: 083A8DE1ED14, DevID: 1
ğŸ“¤ [1] ç™¼é€ HTTP GET è«‹æ±‚: http://update.feiloli.com.tw:5539/textselectdata/083A8DE1ED14
ğŸ“¥ æ”¶åˆ°å›æ‡‰: [Array(1)]
ğŸ“Š è³‡æ–™é¡å‹: object
ğŸ“ è³‡æ–™é•·åº¦: 1534

ğŸ”„ è™•ç† HTTP å›æ‡‰è³‡æ–™: (1) [â€¦] 'MAC:' '083A8DE1ED14' 'DevID:' 1
ğŸ“Š æª¢æ¸¬åˆ°é™£åˆ—æ•¸æ“šï¼Œè™•ç†å¤š devid... (æŒ‡å®šDevID: 1)
â­ å„ªå…ˆè§£ææŒ‡å®šçš„ devid: 1
ğŸ“¥ é–‹å§‹è§£ææ•¸æ“šï¼Œé¡å‹: object targetDevid: 1
âš™ï¸ è§£æ re_readdata å”è­°æ•¸æ“š...
ğŸ“ parm åå…­é€²ä½å­—ç¬¦ä¸²: 00000000000000000000000000000000...
ğŸ“Š parm å­—ç¬¦ä¸²é•·åº¦: 144 å­—ç¬¦ (72 å­—ç¯€)
ğŸ” å‰ 40 å€‹å­—ç¯€å€¼(åé€²ä½): 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 11, 0, 1, 40, 0, 0, 135, 0, 9, 0, 210, 0, 94, 1
ğŸ“ è©¦ ä½ç½®32-35 (æ­£ç¢ºä½ç½®): bytes[32]=87, bytes[33]=00, bytes[34]=09, bytes[35]=00 â†’ plays=135, payouts=9, æœ‰æ•ˆ=true
âœ… ä½ç½®32-35 æˆåŠŸæå–: plays=135, payouts=9

âœ… devid 1 æ•¸æ“šå·²å„²å­˜: {raw: {â€¦}, plays: 135, payouts: 9, timestamp: '14:35:22', format: 're_readdata', hasData: true}
ğŸ“ æª¢æŸ¥ä¸¦æ›´æ–°æ¯æ—¥è¨˜éŒ„ - æ©Ÿå°: A001/ä¸Š1, plays: 135, payouts: 9
ğŸ”„ æ•¸æ“šæœ‰è®ŠåŒ– - æ©Ÿå°: A001/ä¸Š1
   â­ æŠ•å¹£æ¬¡æ•¸è®ŠåŒ–: 130 â†’ 135 (å¢åŠ : +5)
   â­ å‡ºè²¨æ•¸é‡è®ŠåŒ–: 8 â†’ 9 (å¢åŠ : +1)
âœ… å·²æ›´æ–°ä»Šæ—¥è¨˜éŒ„ - æ©Ÿå°: A001/ä¸Š1, plays: 135, payouts: 9, æ›´æ–°æ¬¡æ•¸: 3
   ğŸ“Š æ›´æ–°çµ±è¨ˆ: playsè®ŠåŒ–=true, payoutsè®ŠåŒ–=true, æ­·å²è¨˜éŒ„æ•¸=3

ğŸ”„ å·²åˆ·æ–°è‡ªå‹•è¨˜å¸³è¡¨æ ¼ï¼Œå…± 1 ç­†è¨˜éŒ„

âœ… è¼ªè©¢å®Œæˆï¼
- å·²æŸ¥è©¢: 3 å°æ©Ÿå°
- æ–°å¢: 1 ç­†è¨˜éŒ„
- æ›´æ–°: 2 ç­†è¨˜éŒ„
- è€—æ™‚: 3.2 ç§’

==============================================

âœ… æ‰¹é‡æ–°å¢æ‰€æœ‰æ©Ÿå°è¨˜éŒ„ (å¢å¼·ç‰ˆ)...
âœ… æ‰¾åˆ° A001/ä¸Š1 çš„è¨˜éŒ„
âœ… å·²è¨­ç½®é¸æ“‡å™¨: docId=doc1, value=doc1
ğŸ“‹ è¡¨å–®å·²å¡«å…¥: {date: '2025-10-23', machineDocId: 'doc1', plays: 135, payouts: 9}
ğŸ”„ æª¢æ¸¬åˆ°è®ŠåŒ– - æŠ•å¹£æ•¸è®ŠåŒ–: true, å‡ºè²¨æ•¸é‡è®ŠåŒ–: true
ğŸ”„ å·²æ–°å¢/æ›´æ–° A001/ä¸Š1 çš„è¨˜éŒ„
âœ¨ æ–°å¢è¨˜éŒ„ - æ©Ÿå°: A001/ä¸Š2
ğŸ”„ å·²æ–°å¢/æ›´æ–° A001/ä¸Š2 çš„è¨˜éŒ„
ğŸ‰ æ‰¹é‡æ“ä½œå®Œæˆçµ±è¨ˆ:
   âœ¨ æ–°å¢è¨˜éŒ„: 1 ç­†
      A001/ä¸Š2
   ğŸ”„ æ›´æ–°è¨˜éŒ„: 1 ç­†
      A001/ä¸Š1 (ğŸ’°æŠ•å¹£ã€ğŸ“¦å‡ºè²¨)
   âŒ å¤±æ•—: 0 ç­†

ğŸ—‘ï¸ æ¸…é™¤ HTTP è¼ªè©¢è‡ªå‹•è¨˜å¸³è¡¨æ ¼...
âœ… å·²åˆ·æ–°è‡ªå‹•è¨˜å¸³è¡¨æ ¼ï¼Œå…± 0 ç­†è¨˜éŒ„
```

---

## ğŸ¯ API åƒè€ƒ

### `updateDailyRecord(machineId, location, plays, payouts, date)`

**åƒæ•¸**:
- `machineId` (string): æ©Ÿå°ç·¨è™Ÿ (å¦‚ "A001")
- `location` (string): æ©Ÿå°ä½ç½® (å¦‚ "ä¸Š1")
- `plays` (number): æŠ•å¹£æ¬¡æ•¸
- `payouts` (number): å‡ºè²¨æ•¸é‡
- `date` (string, optional): æ—¥æœŸ (æ ¼å¼: "YYYY-MM-DD", é»˜èªç‚ºä»Šå¤©)

**è¿”å›å€¼**:
```javascript
{
    status: 'created' | 'updated' | 'unchanged',
    record: { ...è¨˜éŒ„ç‰©ä»¶ },
    playsChanged: boolean,     // âœ… æ–°å¢
    payoutsChanged: boolean,   // âœ… æ–°å¢
    playsDelta: number,        // âœ… æ–°å¢
    payoutsDelta: number       // âœ… æ–°å¢
}
```

### `pollAllMachines()`

**åŠŸèƒ½**: è¼ªè©¢æ‰€æœ‰æœ‰ MAC ä½å€çš„æ©Ÿå°

**åƒæ•¸**: ç„¡

**è¿”å›å€¼**: Promise

**å‰¯ä½œç”¨**:
- ä¿®æ”¹ `window.dailyRecords`
- é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
- è¼¸å‡ºè©³ç´°æ—¥èªŒ

### `batchAddAllMachines()`

**åŠŸèƒ½**: æ‰¹é‡æ–°å¢æ‰€æœ‰æ©Ÿå°è¨˜éŒ„åˆ°ç³»çµ±

**åƒæ•¸**: ç„¡

**è¿”å›å€¼**: void

**å‰¯ä½œç”¨**:
- è§¸ç™¼è¡¨å–®æäº¤äº‹ä»¶
- æ¸…ç©º `window.dailyRecords`
- åˆ·æ–°è‡ªå‹•è¨˜å¸³è¡¨æ ¼

### `refreshAutoRecordTable()`

**åŠŸèƒ½**: åˆ·æ–°è‡ªå‹•è¨˜å¸³è¡¨æ ¼é¡¯ç¤º

**åƒæ•¸**: ç„¡

**è¿”å›å€¼**: void

**å‰¯ä½œç”¨**:
- æ›´æ–° DOM ä¸­çš„è¡¨æ ¼å…§å®¹
- é¡¯ç¤ºè®Šæ›´æŒ‡ç¤ºç¬¦å’Œè®Šæ›´å€¼

---

## âœ¨ æ”¹é€²æˆæœç¸½çµ

| æ–¹é¢ | èˆŠç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| **è®ŠåŒ–æª¢æ¸¬** | æ•´é«”æª¢æ¸¬ | ç¨ç«‹æª¢æ¸¬æŠ•å¹£å’Œå‡ºè²¨ |
| **è®ŠåŒ–å€¼è¨˜éŒ„** | ä¸è¨˜éŒ„ | è¨˜éŒ„ Delta å€¼ |
| **æ­·å²æ•¸æ“š** | ç°¡å–®åˆ—è¡¨ | è©³ç´°çš„è®ŠåŒ–æ¨™è¨˜ |
| **è¡¨æ ¼æŒ‡ç¤º** | ç°¡å–®è¨ˆæ•¸ | è¤‡é›œçš„ç¬¦è™ŸæŒ‡ç¤º |
| **æ“ä½œåˆ†é¡** | ä¸€å¾‹æ–°å¢ | æ™ºèƒ½å€åˆ†æ–°å¢/æ›´æ–° |
| **çµ±è¨ˆä¿¡æ¯** | ç¼ºä¹ | è©³ç´°çµ±è¨ˆ |
| **ç”¨æˆ¶åé¥‹** | åŸºç¤ | è©³ç´°å’Œå±¤ç´šåŒ– |
| **æ—¥èªŒè¼¸å‡º** | æ¨™æº– | å¯Œæœ‰ä¿¡æ¯çš„è©³ç´°æ—¥èªŒ |

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- ğŸ“„ `HTTP_è¼ªè©¢è‡ªå‹•è¨˜å¸³_æ”¹é€²èªªæ˜.md` - åŠŸèƒ½èªªæ˜æ–‡æª”
- ğŸ“‹ `index.html` - ä¸»ç¨‹åºæ–‡ä»¶
- ğŸ” å…¶ä»–åƒè€ƒï¼š`HTTP_CONFIG_README.md`ã€`parmç ´è§£å®Œæˆå ±å‘Š.txt` ç­‰

