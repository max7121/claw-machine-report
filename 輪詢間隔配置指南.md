# 🔄 HTTP 輪詢間隔配置指南

## ✅ 新增功能

已將輪詢間隔更新為支持**更精細的時間設定**，從最短 **0.5 秒** 到最長 **5 分鐘**。

---

## 📊 可用的輪詢間隔選項

| 間隔 | 描述 | 最適用場景 |
|------|------|----------|
| **0.5秒** | 超高頻更新 | ⚡ 實時監控/演示 |
| **1秒** | 高頻更新 | 📊 實時數據監控 |
| **2秒** | 快速更新 | 🎯 快速反應應用 |
| **3秒** | 中快速更新 | ⚙️ 通用實時應用 |
| **5秒** | 中等更新 | 📈 一般業務應用 |
| **10秒** | 🔧 **(默認)** | 💼 正常使用 |
| **30秒** | 低頻更新 | 🌐 網路限制環境 |
| **1分鐘** | 很低頻 | 📱 移動設備 |
| **5分鐘** | 極低頻 | 🔋 省電模式 |

---

## 🎮 如何使用

### 方法 1：使用下拉菜單（推薦）

1. 找到「**HTTP 即時同步**」部分
2. 在「間隔：」下拉菜單中選擇需要的時間
3. ✅ 立即生效

### 方法 2：啟用自動輪詢

1. 勾選「**啟用自動輪詢所有機台**」複選框
2. 在下拉菜單中選擇間隔時間
3. ✅ 輪詢自動開始

### 方法 3：通過控制台動態修改

在瀏覽器控制台（F12 → Console）執行：

```javascript
// 修改輪詢間隔（單位：毫秒）
document.getElementById('poll-interval').value = 1000; // 改為 1 秒

// 如果正在輪詢，重新啟動以應用新設定
stopAutoPolling();
startAutoPolling();
```

---

## 🚀 性能建議

### ⚡ 如果選擇很短的間隔（0.5秒 ~ 2秒）

**優點**：
- ✅ 數據更新非常及時
- ✅ 適合實時監控

**注意事項**：
- ⚠️ 網路流量會增加 2-10 倍
- ⚠️ 伺服器負載會增加
- ⚠️ 在不穩定的網路環境中可能出現請求堆積
- ⚠️ 移動設備上會增加電量消耗

**建議**：
- 只在需要實時監控時使用
- 確保網路連接穩定
- 監控伺服器的 CPU 和帶寬使用情況

### 💼 如果選擇中等間隔（5秒 ~ 10秒）

**優點**：
- ✅ 在性能和實時性之間取得平衡
- ✅ 適合大多數業務應用
- ✅ 網路和伺服器負載合理

**推薦**：
- 大多數情況下使用 **10 秒**
- 如果數據變化頻繁，可改為 **5 秒**

### 🔋 如果選擇很長的間隔（30秒 ~ 5分鐘）

**優點**：
- ✅ 最小化網路流量
- ✅ 減輕伺服器負載
- ✅ 移動設備省電

**適用場景**：
- 定期檢查而非實時監控
- 網路限制環境
- 伺服器資源受限

---

## 📋 實時監控最佳實踐

### 場景 1：單個機台實時監控

```javascript
// 1. 設置為 1-2 秒間隔
document.getElementById('poll-interval').value = 1000;

// 2. 啟動自動輪詢
document.getElementById('auto-poll-enabled').checked = true;
startAutoPolling();

// 3. 在控制台查看實時日誌
// （所有請求會被記錄到 Console）
```

### 場景 2：多個機台定期檢查

```javascript
// 1. 設置為 10-30 秒間隔
document.getElementById('poll-interval').value = 10000;

// 2. 啟動自動輪詢
document.getElementById('auto-poll-enabled').checked = true;
startAutoPolling();
```

### 場景 3：手動觸發單次查詢

```javascript
// 無需自動輪詢，只在需要時手動查詢
// 點擊「📊 立即輪詢所有機台」按鈕
// 或執行
pollAllMachines();
```

---

## 🔍 監控輪詢狀態

### 查看當前配置

```javascript
// 查看當前選擇的間隔
console.log('當前間隔:', document.getElementById('poll-interval').value, '毫秒');

// 查看輪詢是否啟用
console.log('自動輪詢啟用:', document.getElementById('auto-poll-enabled').checked);
```

### 查看輪詢統計

```javascript
// 查看已發送的請求數
console.log('請求計數:', httpRequestCount);

// 查看錯誤計數
console.log('錯誤計數:', httpErrorCount);

// 查看最後的回應
console.log('最後回應:', httpLastResponse);
```

### 實時監控日誌

```javascript
// 查看完整的命令日誌
// 所有發送和接收的數據都會被記錄在頁面的「命令記錄」區域
```

---

## ⚙️ 高級配置

### 動態調整輪詢間隔函數

如果需要在程序中動態調整輪詢間隔：

```javascript
// 函數：改變輪詢間隔
function changePollingInterval(milliseconds) {
    // 驗證間隔有效性
    if (milliseconds < 500) {
        console.warn('⚠️ 間隔過短，最小設置為 500ms');
        milliseconds = 500;
    }
    
    // 更新下拉菜單
    document.getElementById('poll-interval').value = milliseconds;
    
    // 如果正在輪詢，重新啟動
    if (document.getElementById('auto-poll-enabled').checked) {
        stopAutoPolling();
        startAutoPolling();
        console.log(`✅ 輪詢間隔已改為 ${milliseconds}ms`);
    }
}

// 使用示例
changePollingInterval(2000); // 改為 2 秒
```

### 條件性輪詢

```javascript
// 根據時間自動調整間隔
function adaptivePolling() {
    const hour = new Date().getHours();
    
    if (hour >= 9 && hour <= 17) {
        // 工作時間：快速更新（3秒）
        changePollingInterval(3000);
    } else {
        // 非工作時間：低頻更新（30秒）
        changePollingInterval(30000);
    }
}

// 每小時檢查一次
setInterval(adaptivePolling, 60 * 60 * 1000);
```

---

## 📊 性能監控

### 監控網路流量

```javascript
// 計算每分鐘的請求數
function calculateRequestsPerMinute() {
    // 如果間隔是 1000ms (1秒)，則每分鐘 60 次請求
    const interval = parseInt(document.getElementById('poll-interval').value);
    const rpm = 60000 / interval;
    console.log(`📊 每分鐘請求數: ${rpm.toFixed(1)}`);
}

// 計算每小時的數據流量
function estimateDataUsage() {
    // 假設每個請求回應約 500 bytes
    const interval = parseInt(document.getElementById('poll-interval').value);
    const rpm = 60000 / interval;
    const bytesPerHour = rpm * 60 * 500;
    const mbPerHour = (bytesPerHour / 1024 / 1024).toFixed(2);
    console.log(`📡 估計每小時數據用量: ${mbPerHour} MB`);
}

// 使用示例
calculateRequestsPerMinute();
estimateDataUsage();
```

---

## 🐛 故障排除

### 問題 1：輪詢似乎沒有按預期時間運行

**解決方案**：
```javascript
// 檢查輪詢是否真的在運行
console.log('輪詢啟用:', document.getElementById('auto-poll-enabled').checked);
console.log('當前間隔:', document.getElementById('poll-interval').value);

// 檢查定時器是否存在
console.log('定時器 ID:', pollInterval);
```

### 問題 2：改變間隔後沒有立即生效

**解決方案**：
```javascript
// 需要重新啟動輪詢
stopAutoPolling();
startAutoPolling();
// 或勾選和取消勾選「啟用自動輪詢所有機台」
```

### 問題 3：網路流量過高

**解決方案**：
- 增加輪詢間隔（改為 10 秒或以上）
- 只輪詢需要的機台而不是全部
- 在非工作時間降低輪詢頻率

---

## 📝 代碼修改說明

### 修改位置 1：HTML UI（第 441-450 行）
- ✅ 添加了新的間隔選項
- ✅ 保留了原有功能
- ✅ 默認選擇改為 10 秒

### 修改位置 2：JavaScript 事件監聽（第 7050-7063 行）
- ✅ 自動檢測間隔選擇
- ✅ 改變間隔時自動重啟輪詢
- ✅ 無需手動干預

### 修改位置 3：輪詢函數（第 7138-7159 行）
- ✅ `startAutoPolling()` 讀取選擇的間隔
- ✅ `stopAutoPolling()` 正確停止定時器
- ✅ 狀態消息提示當前間隔

---

## ✨ 總結

| 項目 | 詳情 |
|------|------|
| **最短間隔** | 0.5 秒 |
| **最長間隔** | 5 分鐘 |
| **默認間隔** | 10 秒 |
| **推薦間隔** | 10 秒（一般使用） / 5 秒（快速應用） |
| **使用方法** | 下拉菜單選擇 + 勾選自動輪詢 |
| **即時修改** | 下拉菜單選擇後立即生效 |
| **性能影響** | 間隔越短，伺服器負載越高 |

---

**最後更新**：2025-10-23  
**適用版本**：修改後的 index.html  
**功能狀態**：✅ 完全實現
