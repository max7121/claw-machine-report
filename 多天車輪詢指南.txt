ğŸ¯ å¤šå¤©è»Šæ©Ÿå°è¼ªè©¢æŒ‡å—
==================

## ğŸ“‹ åŠŸèƒ½èªªæ˜

ç³»çµ±ç¾åœ¨æ”¯æŒ **å¤šå€‹å¤©è»Šæ©Ÿå°çš„æ™ºèƒ½è¼ªè©¢**ï¼š

- âœ… **devid è­˜åˆ¥** - è‡ªå‹•è­˜åˆ¥å·¦å¤©è»Š (ID:1) å’Œå³å¤©è»Š (ID:2)
- âœ… **ç¨ç«‹è¼ªè©¢** - ç‚ºæ¯å€‹æ©Ÿå°å–®ç¨é€²è¡Œ HTTP è¼ªè©¢
- âœ… **ç¨ç«‹å­˜å„²** - æ¯å€‹ devid çš„æœ€æ–°æ•¸æ“šå–®ç¨ä¿å­˜
- âœ… **ç¨ç«‹é¡¯ç¤º** - åœ¨ UI ä¸Šåˆ†åˆ¥é¡¯ç¤ºæ¯å€‹å¤©è»Šçš„æ•¸æ“š
- âœ… **æœ€æ–°æ•¸æ“š** - è‡ªå‹•å¾å›æ‡‰ä¸­æå–æœ€æ–°çš„ re_readdata æ•¸æ“š

## ğŸ—ï¸ æ•¸æ“šçµæ§‹

### å­˜å„²ä½ç½®

ç³»çµ±åœ¨å…¨åŸŸç¯„åœå…§ä½¿ç”¨ä»¥ä¸‹è®Šæ•¸å­˜å„²å¤šå¤©è»Šæ•¸æ“šï¼š

```javascript
// å–®å€‹ devid çš„æ•¸æ“š
window.machineDataByDevid = {
    1: {
        plays: 296,              // å·¦å¤©è»Šçš„æŠ•å¹£æ•¸
        payouts: 87,             // å·¦å¤©è»Šçš„å‡ºçæ¬¡æ•¸
        timestamp: "14:30:45",
        format: "re_readdata",
        devid: 1
    },
    2: {
        plays: 450,              // å³å¤©è»Šçš„æŠ•å¹£æ•¸
        payouts: 120,            // å³å¤©è»Šçš„å‡ºçæ¬¡æ•¸
        timestamp: "14:30:45",
        format: "re_readdata",
        devid: 2
    }
}
```

## ğŸš€ å·¥ä½œæµç¨‹

### è¼ªè©¢æ™‚çš„è‡ªå‹•è™•ç†

```
1ï¸âƒ£ é»æ“Šã€Œå•Ÿç”¨è‡ªå‹•è¼ªè©¢æ‰€æœ‰æ©Ÿå°ã€æˆ–ã€Œæ¸¬è©¦ HTTP é€£ç·šã€
   â†“
2ï¸âƒ£ ç³»çµ±é€å€‹æŸ¥è©¢æ¯å€‹æ©Ÿå°çš„ MAC åœ°å€
   â†“
3ï¸âƒ£ ä¼ºæœå™¨è¿”å›åŒ…å«å¤šå€‹ re_readdata å‘½ä»¤çš„é™£åˆ—
   â†“
4ï¸âƒ£ ç³»çµ±è‡ªå‹•æª¢æ¸¬é™£åˆ—ä¸­æ‰€æœ‰çš„ devid
   â†“
5ï¸âƒ£ ç‚ºæ¯å€‹ devid æå–æœ€æ–°çš„æ•¸æ“š
   â†“
6ï¸âƒ£ æŒ‰ devid åˆ†åˆ¥å„²å­˜æ•¸æ“š
   â†“
7ï¸âƒ£ åœ¨ UI ä¸Šåˆ†åˆ¥é¡¯ç¤ºæ¯å€‹å¤©è»Šçš„æŠ•å¹£å’Œå‡ºçæ•¸æ“š
```

## ğŸ“Š UI é¡¯ç¤º

### å–®å€‹å¤©è»Šæ•¸æ“šå¡ç‰‡

ç•¶è¼ªè©¢æˆåŠŸæ™‚ï¼Œé é¢æœƒé¡¯ç¤ºï¼š

```
å·¦å¤©è»Šæ•¸æ“šè§£æçµæœ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… æŠ•å¹£éŠæˆ²æ¬¡æ•¸              â”‚
â”‚       296                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ç¦®å“å‡ºçæ¬¡æ•¸              â”‚
â”‚        87                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¼å¼: re_readdata | æ™‚é–“: 14:30:45


å³å¤©è»Šæ•¸æ“šè§£æçµæœ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… æŠ•å¹£éŠæˆ²æ¬¡æ•¸              â”‚
â”‚       450                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ç¦®å“å‡ºçæ¬¡æ•¸              â”‚
â”‚       120                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¼å¼: re_readdata | æ™‚é–“: 14:30:45
```

## ğŸ” æ§åˆ¶å°æ—¥èªŒ

### è¼ªè©¢éç¨‹ä¸­çš„æ—¥èªŒè¼¸å‡º

```
ğŸ“Š æª¢æ¸¬åˆ°é™£åˆ—æ•¸æ“šï¼Œè™•ç†å¤š devid...
ğŸ” æ‰¾åˆ°çš„ devid: [1, 2]
âœ… devid 1 æ•¸æ“šå·²å„²å­˜: {plays: 296, payouts: 87, ...}
ğŸ’¾ devid 1 æ•¸æ“šå·²ä¿å­˜
âœ… devid 2 æ•¸æ“šå·²å„²å­˜: {plays: 450, payouts: 120, ...}
ğŸ’¾ devid 2 æ•¸æ“šå·²ä¿å­˜
```

## ğŸ’¾ æ•¸æ“šè¨ªå•

### åœ¨ JavaScript ä¸­è¨ªå•æ•¸æ“š

```javascript
// è¨ªå•æ‰€æœ‰æ©Ÿå°çš„æ•¸æ“š
console.log(window.machineDataByDevid);
// è¼¸å‡º: {1: {...}, 2: {...}}

// è¨ªå•ç‰¹å®šæ©Ÿå°çš„æ•¸æ“š
const leftMachineData = window.machineDataByDevid[1];
console.log(leftMachineData.plays);   // 296

const rightMachineData = window.machineDataByDevid[2];
console.log(rightMachineData.payouts); // 120

// è¨ˆç®—åˆè¨ˆ
const totalPlays = (window.machineDataByDevid[1]?.plays || 0) + 
                   (window.machineDataByDevid[2]?.plays || 0);
console.log('ç¸½æŠ•å¹£æ•¸:', totalPlays);  // 746

const totalPayouts = (window.machineDataByDevid[1]?.payouts || 0) + 
                     (window.machineDataByDevid[2]?.payouts || 0);
console.log('ç¸½å‡ºçæ¬¡æ•¸:', totalPayouts);  // 207
```

## ğŸ›ï¸ æ©Ÿå°é…ç½®

### åœ¨ã€Œå»ºç«‹æ–°æ©Ÿå°ã€ä¸­è¨­ç½®

ç•¶æ‚¨å»ºç«‹æ–°æ©Ÿå°æ™‚ï¼Œéœ€è¦é…ç½® devidï¼š

| å­—æ®µ | å€¼ | èªªæ˜ |
|------|-----|------|
| æ©Ÿå°ç·¨è™Ÿ | A01 | æ‚¨è‡ªå®šç¾©çš„åç¨± |
| ä½ç½®/å…§å®¹ç‰© | å·¦å¤©è»Š/å¤§å¨ƒå¨ƒ | æ©Ÿå°çš„ä½ç½® |
| æ©Ÿå° MAC ä½å€ | 083A8DE1ED14 | æ©Ÿå°çš„ç¡¬é«”ä½å€ |
| **è¨­å‚™ ID (MQTT)** | **1** æˆ– **2** | â­ **1=å·¦å¤©è»Š, 2=å³å¤©è»Š** |

### ä¾‹å­

```
æ©Ÿå° 1:
  åç¨±: å·¦å¤©è»Š
  MAC: 083A8DE1ED14
  DevID: 1  â† å·¦å¤©è»Š

æ©Ÿå° 2:
  åç¨±: å³å¤©è»Š
  MAC: 083AF2C1B56D
  DevID: 2  â† å³å¤©è»Š
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### æ–¹æ³• 1: å–®æ©Ÿå°æ¸¬è©¦

1. é»æ“ŠæŸå€‹æ©Ÿå°çš„ã€ŒæŸ¥è©¢ã€æŒ‰éˆ•
2. ç³»çµ±ç™¼é€è«‹æ±‚ï¼Œè‡ªå‹•æå–è©² devid çš„æœ€æ–°æ•¸æ“š
3. åœ¨ UI ä¸Šçœ‹åˆ°ç›¸æ‡‰çš„æ•¸æ“šå¡ç‰‡

### æ–¹æ³• 2: æ‰¹é‡è¼ªè©¢æ¸¬è©¦

1. é»æ“Šã€Œå•Ÿç”¨è‡ªå‹•è¼ªè©¢æ‰€æœ‰æ©Ÿå°ã€
2. ç³»çµ±é€å€‹æŸ¥è©¢æ‰€æœ‰é…ç½®çš„æ©Ÿå°
3. åœ¨ UI ä¸Šçœ‹åˆ°æ‰€æœ‰å¤©è»Šçš„æ•¸æ“šå¡ç‰‡

### æ–¹æ³• 3: æ§åˆ¶å°é©—è­‰

æŒ‰ F12 æ‰“é–‹æ§åˆ¶å°ï¼ŒåŸ·è¡Œï¼š

```javascript
// æŸ¥çœ‹æ‰€æœ‰æ©Ÿå°çš„æœ€æ–°æ•¸æ“š
console.log('æ‰€æœ‰å¤©è»Šæ•¸æ“š:', window.machineDataByDevid);

// æŸ¥çœ‹å·¦å¤©è»Šæ•¸æ“š
console.log('å·¦å¤©è»ŠæŠ•å¹£:', window.machineDataByDevid[1]?.plays);
console.log('å·¦å¤©è»Šå‡ºç:', window.machineDataByDevid[1]?.payouts);

// æŸ¥çœ‹å³å¤©è»Šæ•¸æ“š
console.log('å³å¤©è»ŠæŠ•å¹£:', window.machineDataByDevid[2]?.plays);
console.log('å³å¤©è»Šå‡ºç:', window.machineDataByDevid[2]?.payouts);

// è¨ˆç®—ç¸½æ•¸
if (window.machineDataByDevid[1] && window.machineDataByDevid[2]) {
    const totalPlays = window.machineDataByDevid[1].plays + window.machineDataByDevid[2].plays;
    const totalPayouts = window.machineDataByDevid[1].payouts + window.machineDataByDevid[2].payouts;
    console.log('ç¸½è¨ˆ:', {æŠ•å¹£: totalPlays, å‡ºç: totalPayouts});
}
```

## ğŸ”„ è¼ªè©¢éç¨‹è©³è§£

### èª¿ç”¨å †æ£§

```
pollAllMachines()
    â†“ (ç‚ºæ¯å€‹æ©Ÿå°)
pollSingleMachine(mac, devid)
    â†“
sendHttpRequest(mac)
    â†“
ä¼ºæœå™¨è¿”å› JSON é™£åˆ—
    â†“
handleHttpResponse(data, mac, devid)
    â†“ (å¦‚æœæ˜¯é™£åˆ—)
æª¢æ¸¬æ‰€æœ‰ devid
    â†“
for each devid:
    parseHttpData(data, targetDevid)
        â†“
    æŸ¥æ‰¾è©² devid æœ€æ–°çš„ re_readdata
        â†“
    window.machineDataByDevid[devid] = è§£æçµæœ
    updateMachineDataDisplay(data, devid)
        â†“
    åœ¨ UI ä¸Šé¡¯ç¤ºè©² devid çš„æ•¸æ“š
```

## ğŸ“ é—œéµæ”¹é€²

| æ”¹é€² | ä¹‹å‰ | ä¹‹å¾Œ |
|------|------|------|
| å¤š devid æ”¯æŒ | âŒ ç„¡ | âœ… è‡ªå‹•è­˜åˆ¥ |
| æ•¸æ“šéš”é›¢ | âŒ å…¨å±€æ··äº‚ | âœ… æŒ‰ devid åˆ†é›¢ |
| UI é¡¯ç¤º | âŒ å–®å€‹å®¹å™¨ | âœ… æ¯å€‹ devid ç¨ç«‹å®¹å™¨ |
| æœ€æ–°æ•¸æ“šæŸ¥æ‰¾ | âŒ ç¬¬ä¸€æ¢ | âœ… æœ€æ–°ä¸€æ¢ |
| æ•¸æ“šè¨ªå• | âŒ å›°é›£ | âœ… æ˜“ç”¨çš„å…¨åŸŸè®Šæ•¸ |

## ğŸ¯ å¸¸è¦‹ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1: æŸ¥è©¢å–®å€‹å¤©è»Šçš„æŠ•å¹£æ•¸

```javascript
// åœ¨æ§åˆ¶å°ä¸­åŸ·è¡Œ
const leftCoins = window.machineDataByDevid[1]?.plays || 0;
console.log('å·¦å¤©è»ŠæŠ•å¹£æ•¸:', leftCoins);
```

### å ´æ™¯ 2: æ¯”è¼ƒå…©å€‹å¤©è»Šçš„å‡ºçç‡

```javascript
const left = window.machineDataByDevid[1];
const right = window.machineDataByDevid[2];

if (left && right) {
    const leftRate = (left.payouts / left.plays * 100).toFixed(2);
    const rightRate = (right.payouts / right.plays * 100).toFixed(2);
    console.log(`å·¦å¤©è»Šå‡ºçç‡: ${leftRate}%`);
    console.log(`å³å¤©è»Šå‡ºçç‡: ${rightRate}%`);
}
```

### å ´æ™¯ 3: ç›£æ§å…©å°æ©Ÿå°çš„å¯¦æ™‚è®ŠåŒ–

```javascript
// å®šæœŸæª¢æŸ¥è®ŠåŒ–
const prevData = {...window.machineDataByDevid};

// ... é€²è¡Œè¼ªè©¢ ...

// æª¢æŸ¥æ˜¯å¦æœ‰æ–°æ•¸æ“š
if (window.machineDataByDevid[1]?.plays !== prevData[1]?.plays) {
    console.log('âš¡ å·¦å¤©è»ŠæŠ•å¹£æ•¸è®ŠåŒ–äº†!');
}
```

## âœ¨ ç‰¹è‰²åŠŸèƒ½

### è‡ªå‹• devid æª¢æ¸¬

ç³»çµ±æœƒè‡ªå‹•æƒæå›æ‡‰ä¸­çš„æ‰€æœ‰ devidï¼Œä¸éœ€è¦æ‰‹å‹•é…ç½®ï¼š

```
æ£€æµ‹åˆ°çš„ devid: [1, 2, 3]
â†“
è‡ªå‹•ç‚ºæ¯å€‹ devid å‰µå»ºå­˜å„²ç©ºé–“
â†“
è‡ªå‹•ç‚ºæ¯å€‹ devid å‰µå»º UI å®¹å™¨
```

### æ™ºèƒ½æœ€æ–°æ•¸æ“šæå–

å³ä½¿è¿”å›å¤šæ¢ç›¸åŒ devid çš„è¨˜éŒ„ï¼Œç³»çµ±ä¹Ÿæœƒè‡ªå‹•é¸æ“‡æœ€æ–°çš„ä¸€æ¢ï¼š

```
devid=1 çš„è¨˜éŒ„:
  [æ™‚é–“èˆŠ] re_readdata #1
  [æ™‚é–“èˆŠ] re_readdata #2
  [æ™‚é–“æ–°] re_readdata #3 â† é¸æ“‡é€™å€‹
â†“
ä½¿ç”¨ re_readdata #3 çš„æ•¸æ“š
```

## ğŸ”§ é€²éšé…ç½®

### æ·»åŠ æ–°çš„ devid æ¨™ç±¤

å¦‚æœæ‚¨æœ‰ç¬¬ä¸‰å€‹å¤©è»Š (devid=3)ï¼Œç·¨è¼¯ä»£ç¢¼åœ¨ updateMachineDataDisplay ä¸­æ·»åŠ ï¼š

```javascript
const displayLabel = devid ? `å¤©è»Š ${
    devid === 1 ? 'å·¦' : 
    devid === 2 ? 'å³' : 
    devid === 3 ? 'ä¸­' :  // â† æ–°å¢
    devid
}` : 'æ©Ÿå°';
```

## âœ… æª¢æŸ¥æ¸…å–®

æ¸¬è©¦æ™‚ç¢ºä¿ï¼š

- â˜ æ¯å€‹æ©Ÿå°éƒ½é…ç½®äº†ä¸åŒçš„ devid (1, 2 ç­‰)
- â˜ é»æ“Šè¼ªè©¢å¾Œï¼Œæ§åˆ¶å°é¡¯ç¤ºæ‰¾åˆ°çš„æ‰€æœ‰ devid
- â˜ æ¯å€‹ devid éƒ½æœ‰ç¨ç«‹çš„ UI å¡ç‰‡é¡¯ç¤º
- â˜ `window.machineDataByDevid` åŒ…å«æ‰€æœ‰ devid çš„æ•¸æ“š
- â˜ æ•¸æ“šéš¨è‘—æ™‚é–“è‡ªå‹•æ›´æ–°

---

## ğŸš€ ç«‹å³é–‹å§‹

1. **é…ç½®æ©Ÿå°** - ç‚ºå·¦å³å¤©è»Šåˆ†åˆ¥è¨­ç½® devid 1 å’Œ 2
2. **å•Ÿå‹•è¼ªè©¢** - é»æ“Šã€Œå•Ÿç”¨è‡ªå‹•è¼ªè©¢æ‰€æœ‰æ©Ÿå°ã€
3. **æŸ¥çœ‹çµæœ** - åœ¨ UI ä¸Šçœ‹åˆ°å…©å€‹å¤©è»Šçš„ç¨ç«‹æ•¸æ“šå¡ç‰‡
4. **é©—è­‰æ•¸æ“š** - åœ¨æ§åˆ¶å°æª¢æŸ¥ `window.machineDataByDevid`

å®Œæˆï¼æ‚¨çš„å¤šå¤©è»Šç›£æ§ç³»çµ±å·²æº–å‚™å¥½ ğŸ‰
